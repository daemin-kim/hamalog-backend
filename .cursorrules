# Hamalog Project Context for AI Assistants

## í”„ë¡œì íŠ¸ ê°œìš”
HamalogëŠ” **Spring Boot 3.4.5** ê¸°ë°˜ì˜ í—¬ìŠ¤ì¼€ì–´ ë°±ì—”ë“œ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
ë³µì•½ ìŠ¤ì¼€ì¤„ ê´€ë¦¬, ë§ˆìŒ ì¼ê¸° ì‘ì„±, ë¶€ì‘ìš© ê¸°ë¡ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

## ê¸°ìˆ  ìŠ¤íƒ
- **Language**: Java 21 (OpenJDK)
- **Framework**: Spring Boot 3.4.5, Spring Security, Spring Data JPA
- **Database**: MySQL 8.0 (Production), H2 (Development/Test)
- **Cache**: Redis 7 (CSRF í† í°, Rate Limiting, ìºì‹±)
- **Auth**: JWT (jjwt 0.12.6) + CSRF ì´ì¤‘ ë³´í˜¸
- **Migration**: Flyway
- **Build**: Gradle
- **Container**: Docker, Docker Compose
- **CDN/Security**: Cloudflare Tunnel (Zero Trust)

## ì•„í‚¤í…ì²˜
### ë ˆì´ì–´ êµ¬ì¡°
```
Controller (ìš”ì²­ ê²€ì¦, ë¼ìš°íŒ…)
    â†“
Service (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, íŠ¸ëœì­ì…˜)
    â†“
Repository (ë°ì´í„° ì ‘ê·¼, JPA)
    â†“
Domain (ì—”í‹°í‹°, ë„ë©”ì¸ ì´ë²¤íŠ¸)
```

### AOP íš¡ë‹¨ ê´€ì‹¬ì‚¬
- `ApiLoggingAspect` - API ìš”ì²­/ì‘ë‹µ ë¡œê¹…
- `ServiceLoggingAspect` - ì„œë¹„ìŠ¤ ë©”ì„œë“œ ë¡œê¹…
- `PerformanceMonitoringAspect` - ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- `BusinessAuditAspect` - ë¹„ì¦ˆë‹ˆìŠ¤ ê°ì‚¬ ë¡œê¹…
- `RetryAspect` - ì¬ì‹œë„ ë¡œì§
- `CachingAspect` - ìºì‹± ì²˜ë¦¬

## ì½”ë”© ì»¨ë²¤ì…˜

### DTO
- **Java Record** ì‚¬ìš©
- ìš”ì²­: `XxxRequest`, ì‘ë‹µ: `XxxResponse`
- Validation ì–´ë…¸í…Œì´ì…˜ ì ìš© (`@NotNull`, `@Size`, `@Email` ë“±)

```java
public record MoodDiaryCreateRequest(
    @NotNull Long memberId,
    @NotNull LocalDate diaryDate,
    @NotNull MoodType moodType
) {}
```

### Entity
- `@Entity`, `@Table` í•„ìˆ˜
- Lombok ìµœì†Œí™” (ìƒì„±ì ì§ì ‘ ì •ì˜)
- `@Version` ë‚™ê´€ì  ë½ ì ìš©
- ì—°ê´€ê´€ê³„ëŠ” ì§€ì—° ë¡œë”© (`FetchType.LAZY`)

```java
@Entity
@Table(name = "mood_diary")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class MoodDiary {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long moodDiaryId;

    @Version
    private Long version;
}
```

### Service
- SRP ì¤€ìˆ˜ (ê¸°ëŠ¥ë³„ ì„œë¹„ìŠ¤ ë¶„ë¦¬)
- ì˜ˆ: `AuthenticationService`, `MemberRegistrationService`, `MemberDeletionService`
- `@Transactional` ì ì ˆíˆ ì‚¬ìš©
- ì‘ë‹µì€ `XxxResponse.from(entity)` íŒ©í† ë¦¬ ë©”ì„œë“œ ì‚¬ìš©

```java
@Service
@RequiredArgsConstructor
@Transactional(readOnly = true)
public class MoodDiaryService {

    @Transactional
    public MoodDiaryResponse create(MoodDiaryCreateRequest request) {
        // 1. ìœ íš¨ì„± ê²€ì¦
        // 2. ì—”í‹°í‹° ìƒì„±
        // 3. ì €ì¥
        // 4. ì‘ë‹µ ë³€í™˜
        return MoodDiaryResponse.from(savedDiary);
    }
}
```

### Controller
- `@RequireResourceOwnership` ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ ì†Œìœ ê¶Œ ê²€ì¦
- `@Valid` ìš”ì²­ ê²€ì¦
- ResponseEntity ì‚¬ìš©

```java
@RestController
@RequestMapping("/mood-diary")
@RequiredArgsConstructor
public class MoodDiaryController {

    @GetMapping("/{id}")
    @RequireResourceOwnership(resourceType = "MOOD_DIARY", idParam = "id")
    public ResponseEntity<MoodDiaryResponse> getById(@PathVariable Long id) {
        return ResponseEntity.ok(service.findById(id));
    }
}
```

### ì—ëŸ¬ ì²˜ë¦¬
- `ErrorCode` Enum ì‚¬ìš©
- `BusinessException` í‘œì¤€ ì˜ˆì™¸

```java
// ErrorCode ì •ì˜
MEMBER_NOT_FOUND(HttpStatus.NOT_FOUND, "M001", "íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"),

// ì‚¬ìš©
Member member = memberRepository.findById(id)
    .orElseThrow(ErrorCode.MEMBER_NOT_FOUND::toException);
```

### í…ŒìŠ¤íŠ¸
- `@DisplayName` í•œê¸€ ì‘ì„±
- Given-When-Then íŒ¨í„´
- Nested í´ë˜ìŠ¤ë¡œ ê·¸ë£¹í™”

```java
@DisplayName("ë§ˆìŒ ì¼ê¸° ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸")
class MoodDiaryServiceTest {

    @Nested
    @DisplayName("ë§ˆìŒ ì¼ê¸° ìƒì„±")
    class Create {
        @Test
        @DisplayName("ì„±ê³µ: ìœ íš¨í•œ ìš”ì²­ìœ¼ë¡œ ì¼ê¸° ìƒì„±")
        void success() {
            // given
            // when
            // then
        }
    }
}
```

## ì£¼ìš” íŒ¨í„´

### ë¦¬ì†ŒìŠ¤ ì†Œìœ ê¶Œ ê²€ì¦
```java
@RequireResourceOwnership(resourceType = "MEDICATION_SCHEDULE", idParam = "id")
```

### ì¬ì‹œë„
```java
@Retryable(maxAttempts = 3, delay = 1000, backoffMultiplier = 1.5)
```

### ìºì‹±
```java
@Cacheable(value = "memberProfile", key = "#memberId")
@CacheEvict(value = "memberProfile", key = "#memberId")
```

## íŒŒì¼ ìœ„ì¹˜
| ìœ í˜• | ê²½ë¡œ |
|------|------|
| Entity | `src/main/java/com/Hamalog/domain/` |
| DTO | `src/main/java/com/Hamalog/dto/` |
| Service | `src/main/java/com/Hamalog/service/` |
| Controller | `src/main/java/com/Hamalog/controller/` |
| Repository | `src/main/java/com/Hamalog/repository/` |
| Config | `src/main/java/com/Hamalog/config/` |
| AOP | `src/main/java/com/Hamalog/aop/` |
| Test | `src/test/java/com/Hamalog/` |
| DB Migration | `src/main/resources/db/migration/` |
| Messages | `src/main/resources/messages*.properties` |

## ì¤‘ìš” ê·œì¹™
1. **DB ìŠ¤í‚¤ë§ˆ ë³€ê²½ì€ Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ë§Œ** (`V{n}__description.sql`)
2. **ë¯¼ê° ì •ë³´ëŠ” AES ì•”í˜¸í™”** (ì „í™”ë²ˆí˜¸, ìƒë…„ì›”ì¼)
3. **ìƒˆ ì—ëŸ¬ ì½”ë“œëŠ” ErrorCode enumì— ì¶”ê°€**
4. **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ìœ ì§€** (í˜„ì¬ 1,400+ í…ŒìŠ¤íŠ¸)
5. **Spotless í¬ë§·íŒ… ì¤€ìˆ˜** (`./gradlew spotlessApply`)

## ğŸ“š ì°¸ê³  ë¬¸ì„œ
| ë¬¸ì„œ | ê²½ë¡œ | ìš©ë„ |
|------|------|------|
| API ëª…ì„¸ì„œ | `docs/API-specification.md` | REST API ìƒì„¸ |
| í”„ë¡œì íŠ¸ êµ¬ì¡° | `docs/Project-Structure.md` | ë””ë ‰í† ë¦¬ êµ¬ì¡° |
| ì½”ë”© ì»¨ë²¤ì…˜ | `docs/CODING-CONVENTIONS.md` | ì½”ë“œ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ |
| ë°”ì´ë¸Œ ì½”ë”© ê°€ì´ë“œ | `docs/VIBE-CODING-GUIDE.md` | AI í˜‘ì—… ê°€ì´ë“œ |

### ì„ ì–¸ì  íŒ¨í„´ ë¬¸ì„œ (â­ AI í•„ë…)
| ë¬¸ì„œ | ê²½ë¡œ | ë‚´ìš© |
|------|------|------|
| ì–´ë…¸í…Œì´ì…˜ ê°€ì´ë“œ | `docs/patterns/ANNOTATION-GUIDE.md` | ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš©ë²• |
| ì—ëŸ¬ ì²˜ë¦¬ | `docs/patterns/ERROR-HANDLING.md` | ErrorCode, BusinessException |
| ë³´ì•ˆ íŒ¨í„´ | `docs/patterns/SECURITY-PATTERNS.md` | JWT, CSRF, ì†Œìœ ê¶Œ ê²€ì¦ |
| ìºì‹± íŒ¨í„´ | `docs/patterns/CACHING-PATTERNS.md` | Redis ìºì‹œ ì „ëµ |

### ADR (Architecture Decision Records)
| ADR | ì œëª© |
|-----|------|
| 0002 | JWT + CSRF ì´ì¤‘ ë³´í˜¸ |
| 0003 | AOP ê¸°ë°˜ íš¡ë‹¨ ê´€ì‹¬ì‚¬ |
| 0004 | Domain Event íŒ¨í„´ |
| 0005 | Redis ìºì‹œ ì „ëµ |
| 0006 | ë¯¼ê° ë°ì´í„° ì•”í˜¸í™” |

## ğŸ› ï¸ ë„êµ¬
- Swagger UI: `http://localhost:8080/swagger-ui.html`
- CRUD ìŠ¤ìºí´ë”©: `./scripts/generate-crud.sh --domain <Name> --fields "<fields>"`
- ì½”ë“œ í¬ë§·íŒ…: `./gradlew spotlessApply`
- CHANGELOG ìƒì„±: `git-cliff -o CHANGELOG.md`

