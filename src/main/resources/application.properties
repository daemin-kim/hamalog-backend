spring.application.name=Hamalog
spring.messages.encoding=UTF-8

# Server Configuration - Forward Headers (for reverse proxy like Nginx)
# Enable proper client IP resolution from X-Forwarded-For headers
# 'native' uses Tomcat's built-in RemoteIpValve which is more reliable
server.forward-headers-strategy=native

spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:h2:mem:hamalog;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:sa}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:}

spring.jpa.hibernate.ddl-auto=update

# Disable JPA open-in-view (recommended)
spring.jpa.open-in-view=false

# Hibernate Batch Fetch Size - N+1 \uBB38\uC81C \uC644\uD654\uB97C \uC704\uD55C \uBC30\uCE58 \uC870\uD68C \uC124\uC815
# LAZY \uB85C\uB529 \uC2DC IN \uC808\uB85C \uD55C \uBC88\uC5D0 100\uAC1C\uC529 \uBC30\uCE58 \uC870\uD68C
spring.jpa.properties.hibernate.default_batch_fetch_size=100

# Spring Data repository scan settings - JPA only
spring.data.jdbc.repositories.enabled=false
spring.data.redis.repositories.enabled=false

# Transaction Configuration
# Set default transaction timeout to 30 seconds to prevent long-running transactions
spring.transaction.default-timeout=30

# OAuth2 Kakao Configuration - MUST be set via environment variables in production
# Test/dev fallback values provided for local development only
spring.security.oauth2.client.registration.kakao.client-id=${KAKAO_CLIENT_ID:dummy-client-id-for-test}
spring.security.oauth2.client.registration.kakao.client-secret=${KAKAO_CLIENT_SECRET:dummy-client-secret-for-test}
spring.security.oauth2.client.registration.kakao.client-authentication-method=client_secret_post
spring.security.oauth2.client.registration.kakao.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.kakao.redirect-uri=${KAKAO_REDIRECT_URI:https://api.hamalog.shop/oauth2/auth/kakao/callback}
spring.security.oauth2.client.registration.kakao.scope=profile_nickname,account_email
spring.security.oauth2.client.registration.kakao.client-name=kakao

spring.security.oauth2.client.provider.kakao.authorization-uri=https://kauth.kakao.com/oauth/authorize
spring.security.oauth2.client.provider.kakao.token-uri=https://kauth.kakao.com/oauth/token
spring.security.oauth2.client.provider.kakao.user-info-uri=https://kapi.kakao.com/v2/user/me
spring.security.oauth2.client.provider.kakao.user-name-attribute=id

# JWT Configuration - ?? MUST be set via environment variables in production
# ?? WARNING: The fallback value is for LOCAL DEVELOPMENT ONLY!
# ?? PRODUCTION DEPLOYMENT: Set JWT_SECRET environment variable
# Generate secure key: openssl rand -base64 32
jwt.secret=${JWT_SECRET:MDEyMzQ1Njc4OUFCQ0RFRjAxMjM0NTY3ODlBQkNERUY=}
jwt.expiry=${JWT_EXPIRY:1800000}
jwt.refresh-token.expiry=${JWT_REFRESH_TOKEN_EXPIRY:604800000}

# Data encryption key - ?? MUST be set via environment variables in production
# ?? WARNING: The fallback value is for LOCAL DEVELOPMENT ONLY!
# ?? PRODUCTION DEPLOYMENT: Set HAMALOG_ENCRYPTION_KEY environment variable
# Generate secure key: openssl rand -base64 32
# Note: Use ':' operator for local fallback; env var value should be used when provided
hamalog.encryption.key=${HAMALOG_ENCRYPTION_KEY:QUJDREVGMDEyMzQ1Njc4OUFCQ0RFRjAxMjM0NTY3ODk=}

# File Upload Configuration
file.upload.directory=${FILE_UPLOAD_DIR:/uploads/medication-images}
file.upload.max-size=5242880

hamalog.oauth2.redirect-uri=${FRONTEND_URL:https://api.hamalog.shop}/oauth/kakao

# OAuth2 RN App Redirect URI - React Native ? ?????
hamalog.oauth2.rn-app-redirect-scheme=${RN_APP_REDIRECT_SCHEME:hamalog-rn}

# Redis Configuration - Consistent across environments
spring.data.redis.host=${SPRING_DATA_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT:6379}
spring.data.redis.password=${SPRING_DATA_REDIS_PASSWORD:}
spring.data.redis.timeout=2000ms
spring.data.redis.connect-timeout=2000ms

spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8

logging.file.path=${LOG_DIR:./logs}

# CORS Configuration
hamalog.cors.allowed-origins=${ALLOWED_ORIGINS:https://api.hamalog.shop,http://localhost:3000}

# Actuator & Metrics Configuration
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.show-details=when-authorized
management.endpoint.prometheus.enabled=true

# ========================================
# AOP Logging Strategy Configuration
# ========================================
# \uB85C\uAE45 \uC804\uB7B5: Filter \uAE30\uBC18 \uB85C\uAE45(RequestLoggingFilter)\uC744 \uAE30\uBCF8\uC73C\uB85C \uC0AC\uC6A9\uD569\uB2C8\uB2E4.
# AOP \uAE30\uBC18 \uB85C\uAE45\uC740 \uC911\uBCF5\uC744 \uBC29\uC9C0\uD558\uAE30 \uC704\uD574 \uAE30\uBCF8\uC801\uC73C\uB85C \uBE44\uD65C\uC131\uD654\uB429\uB2C8\uB2E4.
# --- AOP \uC124\uC815 ---
# \uC720\uC9C0 \uC911\uC778 AOP:
# - BusinessAuditAspect: \uC778\uC99D \uAD00\uB828 \uAC10\uC0AC \uB85C\uAE45
# - CachingAspect: \uCEE4\uC2A4\uD140 \uCE90\uC2F1 \uCC98\uB9AC
app.aop.global-enabled=true
app.aop.development-mode=false
app.aop.include-stack-trace=false
app.aop.auto-clean-mdc-context=true

# \uBE44\uC988\uB2C8\uC2A4 \uAC10\uC0AC - \uC778\uC99D \uAD00\uB828 \uC791\uC5C5\uB9CC \uB85C\uAE45 (\uD65C\uC131)
app.aop.audit.enabled=true
app.aop.audit.audit-login-failures=true
app.aop.audit.audit-data-changes=false
app.aop.audit.collect-ip-address=true
app.aop.audit.collect-user-agent=true
app.aop.audit.mask-sensitive-params=true
app.aop.audit.max-parameter-length=100
app.aop.audit.max-result-length=100
app.aop.cache.enabled=true

# \uCE90\uC2DC \uC124\uC815
app.aop.cache.enabled=true
app.aop.cache.default-ttl=300
app.aop.cache.max-ttl=86400
app.aop.cache.default-use-local-fallback=true
app.aop.cache.local-cache-max-size=1000
app.aop.cache.collect-stats=true
app.aop.cache.fallback-on-redis-failure=true

# --- Security \uC124\uC815 ---
# CSRF \uBCF4\uD638 \uC124\uC815 (SPA \uD658\uACBD\uC5D0\uC11C HttpOnly Cookie \uC0AC\uC6A9 \uC2DC \uD544\uC218)
# - true: CSRF \uD1A0\uD070 \uAC80\uC99D \uD65C\uC131\uD654 (\uD504\uB85C\uB355\uC158 \uAD8C\uC7A5)
# - false: CSRF \uAC80\uC99D \uBE44\uD65C\uC131\uD654 (\uAC1C\uBC1C/\uD14C\uC2A4\uD2B8 \uC2DC)
# \uCC38\uACE0: ADR-0002 (docs/internal/adr/0002-jwt-csrf-dual-protection.md)
app.security.csrf.enabled=${CSRF_ENABLED:true}

# Trusted Proxy Configuration (for X-Forwarded-For header)
# Docker bridge network, localhost, and common private networks
hamalog.security.trusted-proxies=${TRUSTED_PROXIES:127.0.0.1/32,::1/128,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16}

# Bot Protection Configuration
hamalog.security.bot-protection.enabled=${BOT_PROTECTION_ENABLED:true}
hamalog.security.bot-protection.log-blocked=${BOT_PROTECTION_LOG_BLOCKED:true}

# Flyway Configuration
# DB \uB9C8\uC774\uADF8\uB808\uC774\uC158\uC774 \uD544\uC694 \uC5C6\uB294 H2 \uD14C\uC2A4\uD2B8 \uD658\uACBD\uC5D0\uC11C\uB294 \uBE44\uD65C\uC131\uD654, \uB2E4\uB978 \uD658\uACBD\uC5D0\uC11C \uD544\uC694 \uC2DC \uD65C\uC131\uD654
spring.flyway.enabled=${FLYWAY_ENABLED:false}
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0

# Service logging Aspect toggle
app.aop.service-logging.enabled=false

# ========================================
# Event Store Configuration
# ========================================
# \uB3C4\uBA54\uC778 \uC774\uBCA4\uD2B8 \uC601\uC18D\uD654 \uC124\uC815
# - true: \uBAA8\uB4E0 \uC774\uBCA4\uD2B8\uB97C DB\uC5D0 \uC800\uC7A5 (\uAC10\uC0AC \uCD94\uC801, \uD504\uB85C\uB355\uC158 \uAD8C\uC7A5)
# - false: \uC774\uBCA4\uD2B8 \uC800\uC7A5 \uBE44\uD65C\uC131\uD654 (\uAC1C\uBC1C/\uD14C\uC2A4\uD2B8 \uC2DC DB \uBD80\uD558 \uAC10\uC18C)
# \uCC38\uACE0: ADR-0004 (docs/internal/adr/0004-domain-event-pattern.md)
app.event-store.enabled=${EVENT_STORE_ENABLED:true}

# Rate limiting defaults (can be tuned via environment)
hamalog.rate-limit.auth.per-minute=${RATE_LIMIT_AUTH_PER_MINUTE:5}
hamalog.rate-limit.auth.per-hour=${RATE_LIMIT_AUTH_PER_HOUR:20}
hamalog.rate-limit.api.per-minute=${RATE_LIMIT_API_PER_MINUTE:60}
hamalog.rate-limit.api.per-hour=${RATE_LIMIT_API_PER_HOUR:1000}
hamalog.rate-limit.degrade-seconds=${RATE_LIMIT_DEGRADE_SECONDS:300}
hamalog.rate-limit.metrics-enabled=${RATE_LIMIT_METRICS_ENABLED:true}

# ========================================
# Message Queue Configuration (Redis Stream)
# ========================================
# Redis Stream \uAE30\uBC18 \uBE44\uB3D9\uAE30 \uBA54\uC2DC\uC9C0 \uD050 \uC124\uC815
# FCM \uD478\uC2DC \uC54C\uB9BC, \uC774\uBA54\uC77C \uBC1C\uC1A1 \uB4F1 I/O \uC791\uC5C5\uC744 \uBE44\uB3D9\uAE30\uB85C \uCC98\uB9AC\uD569\uB2C8\uB2E4.
# \uCC38\uACE0: ADR-0007 (docs/internal/adr/0007-message-queue-redis-stream.md)

# \uBA54\uC2DC\uC9C0 \uD050 \uD65C\uC131\uD654 \uC5EC\uBD80
# - true: Redis Stream\uC744 \uD1B5\uD55C \uBE44\uB3D9\uAE30 \uCC98\uB9AC (\uD504\uB85C\uB355\uC158 \uAD8C\uC7A5)
# - false: \uAE30\uC874 \uB3D9\uAE30 \uBC29\uC2DD \uC720\uC9C0 (\uAC1C\uBC1C/\uD14C\uC2A4\uD2B8 \uC2DC)
hamalog.queue.enabled=${MESSAGE_QUEUE_ENABLED:false}

# Redis Stream \uD0A4 \uC124\uC815
hamalog.queue.notification-stream=hamalog:notifications
hamalog.queue.dead-letter-stream=hamalog:notifications:dlq

# Consumer Group \uC124\uC815
hamalog.queue.consumer-group=notification-consumers
hamalog.queue.consumer-name=${HOSTNAME:consumer-1}

# \uC7AC\uC2DC\uB3C4 \uBC0F \uBC30\uCE58 \uC124\uC815
hamalog.queue.max-retries=3
hamalog.queue.poll-timeout-seconds=5
hamalog.queue.batch-size=10
hamalog.queue.poll-interval-ms=5000

# Discord Webhook \uC54C\uB9BC (\uB808\uAC70\uC2DC - \uBA54\uC2DC\uC9C0 \uD050 \uC804\uC6A9, \uC0C8 \uC124\uC815\uC740 hamalog.alert \uC0AC\uC6A9)
hamalog.queue.discord.enabled=${DISCORD_WEBHOOK_ENABLED:false}
hamalog.queue.discord.webhook-url=${DISCORD_WEBHOOK_URL:}

# ===== Discord \uC54C\uB9BC \uD1B5\uD569 \uC124\uC815 =====
# Discord \uC54C\uB9BC \uD65C\uC131\uD654/\uBE44\uD65C\uC131\uD654
hamalog.alert.discord.enabled=${DISCORD_ALERT_ENABLED:false}

# \uC11C\uBC84 \uC5D0\uB7EC \uC54C\uB9BC \uC804\uC6A9 Webhook URL (500 \uC5D0\uB7EC, Critical \uC5D0\uB7EC)
hamalog.alert.discord.error-webhook-url=${DISCORD_ERROR_WEBHOOK_URL:}

# DLQ \uC54C\uB9BC \uC804\uC6A9 Webhook URL (\uBA54\uC2DC\uC9C0 \uD050 \uC2E4\uD328)
hamalog.alert.discord.dlq-webhook-url=${DISCORD_DLQ_WEBHOOK_URL:}

# \uCD5C\uC18C \uC54C\uB9BC \uC2EC\uAC01\uB3C4 (LOW, MEDIUM, HIGH, CRITICAL)
# HIGH \uC774\uC0C1\uB9CC \uC54C\uB9BC\uC744 \uBC1B\uC73C\uB824\uBA74 HIGH, CRITICAL\uB9CC \uBC1B\uC73C\uB824\uBA74 CRITICAL
hamalog.alert.discord.min-severity=${DISCORD_ALERT_MIN_SEVERITY:HIGH}

# Rate Limiting \uC124\uC815 (\uC54C\uB9BC \uD3ED\uD0C4 \uBC29\uC9C0)
# \uC2DC\uAC04\uB2F9 \uCD5C\uB300 \uC54C\uB9BC \uC218
hamalog.alert.rate-limit.max-alerts-per-hour=${DISCORD_ALERT_MAX_PER_HOUR:10}
# Rate Limit \uC708\uB3C4\uC6B0 (\uCD08)
hamalog.alert.rate-limit.window-seconds=${DISCORD_ALERT_WINDOW_SECONDS:3600}

