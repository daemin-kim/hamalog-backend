spring.application.name=Hamalog

# Server Configuration - Forward Headers (for reverse proxy like Nginx)
# Enable proper client IP resolution from X-Forwarded-For headers
# 'native' uses Tomcat's built-in RemoteIpValve which is more reliable
server.forward-headers-strategy=native

spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:h2:mem:hamalog;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:sa}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:}

spring.jpa.hibernate.ddl-auto=update

# Disable JPA open-in-view (recommended)
spring.jpa.open-in-view=false

# Spring Data repository scan settings - JPA only
spring.data.jdbc.repositories.enabled=false
spring.data.redis.repositories.enabled=false

# Transaction Configuration
# Set default transaction timeout to 30 seconds to prevent long-running transactions
spring.transaction.default-timeout=30

# OAuth2 Kakao Configuration - MUST be set via environment variables in production
# Test/dev fallback values provided for local development only
spring.security.oauth2.client.registration.kakao.client-id=${KAKAO_CLIENT_ID:dummy-client-id-for-test}
spring.security.oauth2.client.registration.kakao.client-secret=${KAKAO_CLIENT_SECRET:dummy-client-secret-for-test}
spring.security.oauth2.client.registration.kakao.client-authentication-method=client_secret_post
spring.security.oauth2.client.registration.kakao.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.kakao.redirect-uri=${KAKAO_REDIRECT_URI:https://api.hamalog.shop/oauth2/auth/kakao/callback}
spring.security.oauth2.client.registration.kakao.scope=profile_nickname,account_email
spring.security.oauth2.client.registration.kakao.client-name=kakao

spring.security.oauth2.client.provider.kakao.authorization-uri=https://kauth.kakao.com/oauth/authorize
spring.security.oauth2.client.provider.kakao.token-uri=https://kauth.kakao.com/oauth/token
spring.security.oauth2.client.provider.kakao.user-info-uri=https://kapi.kakao.com/v2/user/me
spring.security.oauth2.client.provider.kakao.user-name-attribute=id

# JWT Configuration - ?? MUST be set via environment variables in production
# ?? WARNING: The fallback value is for LOCAL DEVELOPMENT ONLY!
# ?? PRODUCTION DEPLOYMENT: Set JWT_SECRET environment variable
# Generate secure key: openssl rand -base64 32
jwt.secret=${JWT_SECRET:xcrVqYlPMcLeEoEX+h8vjxZ97lS6AETwQJXJSLJ/h8g=}
jwt.expiry=${JWT_EXPIRY:1800000}
jwt.refresh-token.expiry=${JWT_REFRESH_TOKEN_EXPIRY:604800000}

# Data encryption key - ?? MUST be set via environment variables in production
# ?? WARNING: The fallback value is for LOCAL DEVELOPMENT ONLY!
# ?? PRODUCTION DEPLOYMENT: Set HAMALOG_ENCRYPTION_KEY environment variable
# Generate secure key: openssl rand -base64 32
# Note: Use ':' operator for local fallback; env var value should be used when provided
hamalog.encryption.key=${HAMALOG_ENCRYPTION_KEY:ZFRGoRl5CElrJfikdx1TmzQ3U8OJ+J6im5OMjuvsqE=}

# File Upload Configuration
file.upload.directory=${FILE_UPLOAD_DIR:/uploads/medication-images}
file.upload.max-size=5242880

hamalog.oauth2.redirect-uri=${FRONTEND_URL:https://api.hamalog.shop}/oauth/kakao

# OAuth2 RN App Redirect URI - React Native ? ?????
hamalog.oauth2.rn-app-redirect-scheme=${RN_APP_REDIRECT_SCHEME:hamalog-rn}

# Redis Configuration - Consistent across environments
spring.data.redis.host=${SPRING_DATA_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT:6379}
spring.data.redis.password=${SPRING_DATA_REDIS_PASSWORD:}
spring.data.redis.timeout=2000ms
spring.data.redis.connect-timeout=2000ms

spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8

logging.file.path=${LOG_DIR:./logs}

# CORS Configuration
hamalog.cors.allowed-origins=${ALLOWED_ORIGINS:https://api.hamalog.shop,http://localhost:3000}

# Actuator & Metrics Configuration
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.show-details=when-authorized
management.endpoint.prometheus.enabled=true
spring.cloud.vault.enabled=${VAULT_ENABLED:false}

# ========================================
# AOP Logging Strategy Configuration
# ========================================
# \uB85C\uAE45 \uC804\uB7B5: Filter \uAE30\uBC18 \uB85C\uAE45(RequestLoggingFilter)\uC744 \uAE30\uBCF8\uC73C\uB85C \uC0AC\uC6A9\uD569\uB2C8\uB2E4.
# AOP \uAE30\uBC18 \uB85C\uAE45\uC740 \uC911\uBCF5\uC744 \uBC29\uC9C0\uD558\uAE30 \uC704\uD574 \uAE30\uBCF8\uC801\uC73C\uB85C \uBE44\uD65C\uC131\uD654\uB429\uB2C8\uB2E4.
#
# \uB85C\uAE45 \uACC4\uCE35 \uAD6C\uC870:
# 1. RequestLoggingFilter (\uD56D\uC0C1 \uD65C\uC131) - HTTP \uC694\uCCAD/\uC751\uB2F5\uC758 \uD1B5\uD569 \uB85C\uAE45
# 2. ApiLoggingAspect (\uAE30\uBCF8 \uBE44\uD65C\uC131) - \uCEE8\uD2B8\uB864\uB7EC \uB808\uBCA8 \uB85C\uAE45 (Filter\uC640 \uC911\uBCF5)
# 3. ServiceLoggingAspect (\uAE30\uBCF8 \uBE44\uD65C\uC131) - \uC11C\uBE44\uC2A4 \uB808\uBCA8 \uB85C\uAE45 (\uB514\uBC84\uAE45\uC6A9)
# 4. BusinessAuditAspect (\uD65C\uC131) - \uC778\uC99D \uAD00\uB828 \uAC10\uC0AC \uB85C\uAE45\uB9CC
# 5. PerformanceMonitoringAspect (\uAE30\uBCF8 \uBE44\uD65C\uC131) - Repository \uC131\uB2A5 \uCE21\uC815

app.aop.global-enabled=true
app.aop.development-mode=false
app.aop.include-stack-trace=false
app.aop.auto-clean-mdc-context=true

# API \uB85C\uAE45 - Filter\uC5D0\uC11C \uCC98\uB9AC\uD558\uBBC0\uB85C \uAE30\uBCF8 \uBE44\uD65C\uC131
app.aop.api-logging.enabled=false
app.aop.api-logging.max-response-length=200
app.aop.api-logging.max-parameter-length=200

# \uC131\uB2A5 \uBAA8\uB2C8\uD130\uB9C1 - \uD544\uC694 \uC2DC\uC5D0\uB9CC \uD65C\uC131\uD654 (\uB85C\uADF8 \uBCFC\uB968 \uC8FC\uC758)
app.aop.performance.enabled=false
app.aop.performance.slow-threshold=1000
app.aop.performance.very-slow-threshold=3000
app.aop.performance.collect-stats=true
app.aop.performance.log-level=DEBUG

# \uBE44\uC988\uB2C8\uC2A4 \uAC10\uC0AC - \uC778\uC99D \uAD00\uB828 \uC791\uC5C5\uB9CC \uB85C\uAE45 (\uD65C\uC131)
app.aop.audit.enabled=true
app.aop.audit.audit-login-failures=true
app.aop.audit.audit-data-changes=false
app.aop.audit.collect-ip-address=true
app.aop.audit.collect-user-agent=true
app.aop.audit.mask-sensitive-params=true

# Security - Trusted Proxy Configuration (for X-Forwarded-For header)
# Docker bridge network, localhost, and common private networks
hamalog.security.trusted-proxies=${TRUSTED_PROXIES:127.0.0.1/32,::1/128,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16}

# Security - Bot Protection Configuration
hamalog.security.bot-protection.enabled=${BOT_PROTECTION_ENABLED:true}
hamalog.security.bot-protection.log-blocked=${BOT_PROTECTION_LOG_BLOCKED:true}
app.aop.audit.max-parameter-length=100
app.aop.audit.max-result-length=100

app.aop.retry.enabled=true
app.aop.retry.default-max-attempts=3
app.aop.retry.default-delay=1000
app.aop.retry.max-delay=10000
app.aop.retry.default-backoff-multiplier=2.0
app.aop.retry.collect-stats=true

app.aop.cache.enabled=true
app.aop.cache.default-ttl=300
app.aop.cache.max-ttl=86400
app.aop.cache.default-use-local-fallback=true
app.aop.cache.local-cache-max-size=1000
app.aop.cache.collect-stats=true
app.aop.cache.fallback-on-redis-failure=true

# Note: hamalog.security.trusted-proxies is defined above (line ~109)

# Flyway Configuration
# ?? ????? ???? (H2 ??), ??????? ???
spring.flyway.enabled=${FLYWAY_ENABLED:false}
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0

# Service logging Aspect toggle
app.aop.service-logging.enabled=false

# Rate limiting defaults (can be tuned via environment)
hamalog.rate-limit.auth.per-minute=${RATE_LIMIT_AUTH_PER_MINUTE:5}
hamalog.rate-limit.auth.per-hour=${RATE_LIMIT_AUTH_PER_HOUR:20}
hamalog.rate-limit.api.per-minute=${RATE_LIMIT_API_PER_MINUTE:60}
hamalog.rate-limit.api.per-hour=${RATE_LIMIT_API_PER_HOUR:1000}
hamalog.rate-limit.degrade-seconds=${RATE_LIMIT_DEGRADE_SECONDS:300}
hamalog.rate-limit.metrics-enabled=${RATE_LIMIT_METRICS_ENABLED:true}

